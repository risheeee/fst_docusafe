{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/src/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n});\n\nexport async function query(text: string, params?: any[]) {\n  const start = Date.now();\n  try {\n    const res = await pool.query(text, params);\n    const duration = Date.now() - start;\n    console.log('Executed query', { text, duration, rows: res.rowCount });\n    return res;\n  } catch (error) {\n    console.error('Database query error:', error);\n    throw error;\n  }\n}\n\nexport async function initDatabase() {\n  try {\n    await query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n        email VARCHAR(255) UNIQUE NOT NULL,\n        name VARCHAR(255) NOT NULL,\n        password VARCHAR(255) NOT NULL,\n        role VARCHAR(50) NOT NULL CHECK (role IN ('student', 'admin')),\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n      )\n    `);\n\n    await query(`\n      CREATE TABLE IF NOT EXISTS documents (\n        id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n        user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n        file_name VARCHAR(255) NOT NULL,\n        original_name VARCHAR(255) NOT NULL,\n        file_size BIGINT NOT NULL,\n        file_type VARCHAR(100) NOT NULL,\n        file_path VARCHAR(500) NOT NULL,\n        uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n      )\n    `);\n\n    await query(`\n      CREATE INDEX IF NOT EXISTS idx_documents_user_id ON documents(user_id)\n    `);\n\n    await query(`\n      CREATE INDEX IF NOT EXISTS idx_documents_uploaded_at ON documents(uploaded_at DESC)\n    `);\n\n    console.log('Database initialized successfully');\n  } catch (error) {\n    console.error('Error initializing database:', error);\n    throw error;\n  }\n}\n\nexport default pool;\n"],"names":[],"mappings":";;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;AAC5C;AAEO,eAAe,MAAM,IAAY,EAAE,MAAc;IACtD,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACF,MAAM,MAAM,MAAM,KAAK,KAAK,CAAC,MAAM;QACnC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,QAAQ,GAAG,CAAC,kBAAkB;YAAE;YAAM;YAAU,MAAM,IAAI,QAAQ;QAAC;QACnE,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM;IACR;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,MAAM,CAAC;;;;;;;;;IASb,CAAC;QAED,MAAM,MAAM,CAAC;;;;;;;;;;;IAWb,CAAC;QAED,MAAM,MAAM,CAAC;;IAEb,CAAC;QAED,MAAM,MAAM,CAAC;;IAEb,CAAC;QAED,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,MAAM;IACR;AACF;uCAEe"}},
    {"offset": {"line": 141, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/src/lib/auth.ts"],"sourcesContent":["import bcrypt from 'bcryptjs';\nimport { cookies } from 'next/headers';\nimport { query } from './db';\nimport type { User } from '@/types';\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, 10);\n}\n\nexport async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {\n  return bcrypt.compare(password, hashedPassword);\n}\n\nexport async function createUser(name: string, email: string, password: string, role: 'student' | 'admin'): Promise<User> {\n  const hashedPassword = await hashPassword(password);\n  const result = await query(\n    'INSERT INTO users (name, email, password, role) VALUES ($1, $2, $3, $4) RETURNING id, email, name, role, created_at',\n    [name, email, hashedPassword, role]\n  );\n  \n  const user = result.rows[0];\n  return {\n    id: user.id,\n    email: user.email,\n    name: user.name,\n    role: user.role,\n    createdAt: user.created_at,\n  };\n}\n\nexport async function getUserByEmail(email: string): Promise<any> {\n  const result = await query('SELECT * FROM users WHERE email = $1', [email]);\n  return result.rows[0];\n}\n\nexport async function getUserById(id: string): Promise<User | null> {\n  const result = await query('SELECT id, email, name, role, created_at FROM users WHERE id = $1', [id]);\n  if (result.rows.length === 0) return null;\n  \n  const user = result.rows[0];\n  return {\n    id: user.id,\n    email: user.email,\n    name: user.name,\n    role: user.role,\n    createdAt: user.created_at,\n  };\n}\n\nexport async function setUserSession(userId: string): Promise<void> {\n  const cookieStore = await cookies();\n  cookieStore.set('userId', userId, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    maxAge: 60 * 60 * 24 * 7, // 7 days\n    path: '/',\n  });\n}\n\nexport async function getUserSession(): Promise<User | null> {\n  const cookieStore = await cookies();\n  const userId = cookieStore.get('userId')?.value;\n  \n  if (!userId) return null;\n  return getUserById(userId);\n}\n\nexport async function clearUserSession(): Promise<void> {\n  const cookieStore = await cookies();\n  cookieStore.delete('userId');\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;;;;;;;;AAGO,eAAe,aAAa,QAAgB;IACjD,OAAO,8IAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,eAAe,QAAgB,EAAE,cAAsB;IAC3E,OAAO,8IAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,eAAe,WAAW,IAAY,EAAE,KAAa,EAAE,QAAgB,EAAE,IAAyB;IACvG,MAAM,iBAAiB,MAAM,aAAa;IAC1C,MAAM,SAAS,MAAM,IAAA,2HAAK,EACxB,uHACA;QAAC;QAAM;QAAO;QAAgB;KAAK;IAGrC,MAAM,OAAO,OAAO,IAAI,CAAC,EAAE;IAC3B,OAAO;QACL,IAAI,KAAK,EAAE;QACX,OAAO,KAAK,KAAK;QACjB,MAAM,KAAK,IAAI;QACf,MAAM,KAAK,IAAI;QACf,WAAW,KAAK,UAAU;IAC5B;AACF;AAEO,eAAe,eAAe,KAAa;IAChD,MAAM,SAAS,MAAM,IAAA,2HAAK,EAAC,wCAAwC;QAAC;KAAM;IAC1E,OAAO,OAAO,IAAI,CAAC,EAAE;AACvB;AAEO,eAAe,YAAY,EAAU;IAC1C,MAAM,SAAS,MAAM,IAAA,2HAAK,EAAC,qEAAqE;QAAC;KAAG;IACpG,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,GAAG,OAAO;IAErC,MAAM,OAAO,OAAO,IAAI,CAAC,EAAE;IAC3B,OAAO;QACL,IAAI,KAAK,EAAE;QACX,OAAO,KAAK,KAAK;QACjB,MAAM,KAAK,IAAI;QACf,MAAM,KAAK,IAAI;QACf,WAAW,KAAK,UAAU;IAC5B;AACF;AAEO,eAAe,eAAe,MAAc;IACjD,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,GAAG,CAAC,UAAU,QAAQ;QAChC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;QACvB,MAAM;IACR;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,SAAS,YAAY,GAAG,CAAC,WAAW;IAE1C,IAAI,CAAC,QAAQ,OAAO;IACpB,OAAO,YAAY;AACrB;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 239, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/src/app/api/documents/my/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { getUserSession } from '@/lib/auth';\nimport { query } from '@/lib/db';\n\nexport async function GET() {\n  try {\n    const user = await getUserSession();\n\n    if (!user) {\n      return NextResponse.json(\n        { success: false, message: 'Not authenticated' },\n        { status: 401 }\n      );\n    }\n\n    const result = await query(\n      `SELECT d.*, u.name as user_name, u.email as user_email \n       FROM documents d \n       JOIN users u ON d.user_id = u.id \n       WHERE d.user_id = $1 \n       ORDER BY d.uploaded_at DESC`,\n      [user.id]\n    );\n\n    const documents = result.rows.map((row) => ({\n      id: row.id,\n      userId: row.user_id,\n      userName: row.user_name,\n      userEmail: row.user_email,\n      fileName: row.file_name,\n      originalName: row.original_name,\n      fileSize: parseInt(row.file_size),\n      fileType: row.file_type,\n      filePath: row.file_path,\n      uploadedAt: row.uploaded_at,\n    }));\n\n    return NextResponse.json({\n      success: true,\n      documents,\n    });\n  } catch (error) {\n    console.error('Get my documents error:', error);\n    return NextResponse.json(\n      { success: false, message: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,sIAAc;QAEjC,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAAoB,GAC/C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,MAAM,IAAA,2HAAK,EACxB,CAAC;;;;kCAI2B,CAAC,EAC7B;YAAC,KAAK,EAAE;SAAC;QAGX,MAAM,YAAY,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,MAAQ,CAAC;gBAC1C,IAAI,IAAI,EAAE;gBACV,QAAQ,IAAI,OAAO;gBACnB,UAAU,IAAI,SAAS;gBACvB,WAAW,IAAI,UAAU;gBACzB,UAAU,IAAI,SAAS;gBACvB,cAAc,IAAI,aAAa;gBAC/B,UAAU,SAAS,IAAI,SAAS;gBAChC,UAAU,IAAI,SAAS;gBACvB,UAAU,IAAI,SAAS;gBACvB,YAAY,IAAI,WAAW;YAC7B,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,SAAS;QAAwB,GACnD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}