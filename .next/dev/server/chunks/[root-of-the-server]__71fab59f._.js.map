{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/src/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n});\n\nexport async function query(text: string, params?: any[]) {\n  const start = Date.now();\n  try {\n    const res = await pool.query(text, params);\n    const duration = Date.now() - start;\n    console.log('Executed query', { text, duration, rows: res.rowCount });\n    return res;\n  } catch (error) {\n    console.error('Database query error:', error);\n    throw error;\n  }\n}\n\nexport async function initDatabase() {\n  try {\n    await query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n        email VARCHAR(255) UNIQUE NOT NULL,\n        name VARCHAR(255) NOT NULL,\n        password VARCHAR(255) NOT NULL,\n        role VARCHAR(50) NOT NULL CHECK (role IN ('student', 'admin')),\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n      )\n    `);\n\n    await query(`\n      CREATE TABLE IF NOT EXISTS documents (\n        id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n        user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n        file_name VARCHAR(255) NOT NULL,\n        original_name VARCHAR(255) NOT NULL,\n        file_size BIGINT NOT NULL,\n        file_type VARCHAR(100) NOT NULL,\n        file_path VARCHAR(500) NOT NULL,\n        uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n      )\n    `);\n\n    await query(`\n      CREATE INDEX IF NOT EXISTS idx_documents_user_id ON documents(user_id)\n    `);\n\n    await query(`\n      CREATE INDEX IF NOT EXISTS idx_documents_uploaded_at ON documents(uploaded_at DESC)\n    `);\n\n    console.log('Database initialized successfully');\n  } catch (error) {\n    console.error('Error initializing database:', error);\n    throw error;\n  }\n}\n\nexport default pool;\n"],"names":[],"mappings":";;;;;;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;AAC5C;AAEO,eAAe,MAAM,IAAY,EAAE,MAAc;IACtD,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACF,MAAM,MAAM,MAAM,KAAK,KAAK,CAAC,MAAM;QACnC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,QAAQ,GAAG,CAAC,kBAAkB;YAAE;YAAM;YAAU,MAAM,IAAI,QAAQ;QAAC;QACnE,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM;IACR;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,MAAM,CAAC;;;;;;;;;IASb,CAAC;QAED,MAAM,MAAM,CAAC;;;;;;;;;;;IAWb,CAAC;QAED,MAAM,MAAM,CAAC;;IAEb,CAAC;QAED,MAAM,MAAM,CAAC;;IAEb,CAAC;QAED,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,MAAM;IACR;AACF;uCAEe"}},
    {"offset": {"line": 141, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/src/lib/auth.ts"],"sourcesContent":["import bcrypt from 'bcryptjs';\nimport { cookies } from 'next/headers';\nimport { query } from './db';\nimport type { User } from '@/types';\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, 10);\n}\n\nexport async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {\n  return bcrypt.compare(password, hashedPassword);\n}\n\nexport async function createUser(name: string, email: string, password: string, role: 'student' | 'admin'): Promise<User> {\n  const hashedPassword = await hashPassword(password);\n  const result = await query(\n    'INSERT INTO users (name, email, password, role) VALUES ($1, $2, $3, $4) RETURNING id, email, name, role, created_at',\n    [name, email, hashedPassword, role]\n  );\n  \n  const user = result.rows[0];\n  return {\n    id: user.id,\n    email: user.email,\n    name: user.name,\n    role: user.role,\n    createdAt: user.created_at,\n  };\n}\n\nexport async function getUserByEmail(email: string): Promise<any> {\n  const result = await query('SELECT * FROM users WHERE email = $1', [email]);\n  return result.rows[0];\n}\n\nexport async function getUserById(id: string): Promise<User | null> {\n  const result = await query('SELECT id, email, name, role, created_at FROM users WHERE id = $1', [id]);\n  if (result.rows.length === 0) return null;\n  \n  const user = result.rows[0];\n  return {\n    id: user.id,\n    email: user.email,\n    name: user.name,\n    role: user.role,\n    createdAt: user.created_at,\n  };\n}\n\nexport async function setUserSession(userId: string): Promise<void> {\n  const cookieStore = await cookies();\n  cookieStore.set('userId', userId, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    maxAge: 60 * 60 * 24 * 7, // 7 days\n    path: '/',\n  });\n}\n\nexport async function getUserSession(): Promise<User | null> {\n  const cookieStore = await cookies();\n  const userId = cookieStore.get('userId')?.value;\n  \n  if (!userId) return null;\n  return getUserById(userId);\n}\n\nexport async function clearUserSession(): Promise<void> {\n  const cookieStore = await cookies();\n  cookieStore.delete('userId');\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;;;;;;;;AAGO,eAAe,aAAa,QAAgB;IACjD,OAAO,8IAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,eAAe,QAAgB,EAAE,cAAsB;IAC3E,OAAO,8IAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,eAAe,WAAW,IAAY,EAAE,KAAa,EAAE,QAAgB,EAAE,IAAyB;IACvG,MAAM,iBAAiB,MAAM,aAAa;IAC1C,MAAM,SAAS,MAAM,IAAA,2HAAK,EACxB,uHACA;QAAC;QAAM;QAAO;QAAgB;KAAK;IAGrC,MAAM,OAAO,OAAO,IAAI,CAAC,EAAE;IAC3B,OAAO;QACL,IAAI,KAAK,EAAE;QACX,OAAO,KAAK,KAAK;QACjB,MAAM,KAAK,IAAI;QACf,MAAM,KAAK,IAAI;QACf,WAAW,KAAK,UAAU;IAC5B;AACF;AAEO,eAAe,eAAe,KAAa;IAChD,MAAM,SAAS,MAAM,IAAA,2HAAK,EAAC,wCAAwC;QAAC;KAAM;IAC1E,OAAO,OAAO,IAAI,CAAC,EAAE;AACvB;AAEO,eAAe,YAAY,EAAU;IAC1C,MAAM,SAAS,MAAM,IAAA,2HAAK,EAAC,qEAAqE;QAAC;KAAG;IACpG,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,GAAG,OAAO;IAErC,MAAM,OAAO,OAAO,IAAI,CAAC,EAAE;IAC3B,OAAO;QACL,IAAI,KAAK,EAAE;QACX,OAAO,KAAK,KAAK;QACjB,MAAM,KAAK,IAAI;QACf,MAAM,KAAK,IAAI;QACf,WAAW,KAAK,UAAU;IAC5B;AACF;AAEO,eAAe,eAAe,MAAc;IACjD,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,GAAG,CAAC,UAAU,QAAQ;QAChC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;QACvB,MAAM;IACR;AACF;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,SAAS,YAAY,GAAG,CAAC,WAAW;IAE1C,IAAI,CAAC,QAAQ,OAAO;IACpB,OAAO,YAAY;AACrB;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,MAAM,CAAC;AACrB"}},
    {"offset": {"line": 239, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/src/app/api/auth/signup/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { createUser, getUserByEmail, setUserSession } from '@/lib/auth';\nimport { initDatabase } from '@/lib/db';\n\nexport async function POST(request: NextRequest) {\n  try {\n    await initDatabase();\n    \n    const { name, email, password, role } = await request.json();\n\n    if (!name || !email || !password || !role) {\n      return NextResponse.json(\n        { success: false, message: 'All fields are required' },\n        { status: 400 }\n      );\n    }\n\n    if (role !== 'student' && role !== 'admin') {\n      return NextResponse.json(\n        { success: false, message: 'Invalid role' },\n        { status: 400 }\n      );\n    }\n\n    const existingUser = await getUserByEmail(email);\n\n    if (existingUser) {\n      return NextResponse.json(\n        { success: false, message: 'Email already registered' },\n        { status: 409 }\n      );\n    }\n\n    const user = await createUser(name, email, password, role);\n    await setUserSession(user.id);\n\n    return NextResponse.json({\n      success: true,\n      user,\n    });\n  } catch (error) {\n    console.error('Signup error:', error);\n    return NextResponse.json(\n      { success: false, message: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,IAAA,kIAAY;QAElB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE1D,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,YAAY,CAAC,MAAM;YACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAA0B,GACrD;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,SAAS,aAAa,SAAS,SAAS;YAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAAe,GAC1C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,eAAe,MAAM,IAAA,sIAAc,EAAC;QAE1C,IAAI,cAAc;YAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAA2B,GACtD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,IAAA,kIAAU,EAAC,MAAM,OAAO,UAAU;QACrD,MAAM,IAAA,sIAAc,EAAC,KAAK,EAAE;QAE5B,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,SAAS;QAAwB,GACnD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}